{% extends 'base.html' %}

{% block title %}{{ option.source }} to {{ option.destination }} - TravelHub{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-lg-8">
            <!-- Main Travel Option Details -->
            <div class="card mb-4 fade-in">
                <div class="card-body p-5">
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <div>
                            <h2 class="mb-2">
                                <i class="bi bi-geo-alt-fill text-primary"></i>
                                {{ option.source }} → {{ option.destination }}
                            </h2>
                            <p class="text-muted mb-0">Operated by {{ option.operator }}</p>
                        </div>
                        {% if option.type == 'FLIGHT' %}
                        <span class="badge bg-info badge-type fs-6">
                            <i class="bi bi-airplane-fill"></i> Flight
                        </span>
                        {% elif option.type == 'TRAIN' %}
                        <span class="badge bg-success badge-type fs-6">
                            <i class="bi bi-train-front-fill"></i> Train
                        </span>
                        {% else %}
                        <span class="badge bg-warning badge-type fs-6">
                            <i class="bi bi-bus-front-fill"></i> Bus
                        </span>
                        {% endif %}
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card stats-card p-3 text-center">
                                <h5 class="mb-1">
                                    <i class="bi bi-calendar3"></i>
                                    {{ option.departure_date_time|date:"M d, Y" }}
                                </h5>
                                <p class="mb-0 opacity-75">Travel Date</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card stats-card p-3 text-center">
                                <h5 class="mb-1">
                                    <i class="bi bi-clock-fill"></i>
                                    {{ option.duration }}
                                </h5>
                                <p class="mb-0 opacity-75">Journey Time</p>
                            </div>
                        </div>
                    </div>

                    <!-- Journey Timeline -->
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="bi bi-map"></i> Journey Timeline</h5>
                        <div class="d-flex align-items-center">
                            <div class="text-center me-4">
                                <div class="bg-primary rounded-circle p-2 mb-2">
                                    <i class="bi bi-geo-alt-fill text-white"></i>
                                </div>
                                <h6 class="mb-1">{{ option.source }}</h6>
                                <p class="text-muted mb-0">{{ option.departure_date_time|time:"H:i" }}</p>
                            </div>
                            <div class="flex-grow-1 text-center">
                                <div class="d-flex align-items-center">
                                    <div class="border-top border-primary flex-grow-1"></div>
                                    <div class="mx-3">
                                        {% if option.type == 'FLIGHT' %}
                                        <i class="bi bi-airplane text-primary fs-4"></i>
                                        {% elif option.type == 'TRAIN' %}
                                        <i class="bi bi-train-front text-primary fs-4"></i>
                                        {% else %}
                                        <i class="bi bi-bus-front text-primary fs-4"></i>
                                        {% endif %}
                                    </div>
                                    <div class="border-top border-primary flex-grow-1"></div>
                                </div>
                                <p class="text-muted mt-2 mb-0">{{ option.duration }}</p>
                            </div>
                            <div class="text-center ms-4">
                                <div class="bg-success rounded-circle p-2 mb-2">
                                    <i class="bi bi-geo-alt-fill text-white"></i>
                                </div>
                                <h6 class="mb-1">{{ option.destination }}</h6>
                                <p class="text-muted mb-0">{{ option.arrival_date_time|time:"H:i" }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Travel Information -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="bi bi-currency-dollar fs-3 text-primary mb-2"></i>
                                <h5 class="text-primary mb-1">₹{{ option.price }}</h5>
                                <p class="text-muted mb-0">Per Person</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="bi bi-people-fill fs-3 text-success mb-2"></i>
                                <h5 class="text-success mb-1">{{ option.available_seats }}</h5>
                                <p class="text-muted mb-0">Available Seats</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="bi bi-star-fill fs-3 text-warning mb-2"></i>
                                <h5 class="text-warning mb-1">{{ option.travel_id }}</h5>
                                <p class="text-muted mb-0">Travel ID</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Similar Options -->
            {% if similar_options %}
            <div class="card fade-in">
                <div class="card-body">
                    <h5 class="mb-4"><i class="bi bi-lightbulb-fill"></i> Similar Options</h5>
                    <div class="row">
                        {% for similar in similar_options %}
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body p-3">
                                    <h6 class="card-title">{{ similar.departure_date_time|date:"M d" }}</h6>
                                    <p class="text-muted mb-2">{{ similar.departure_date_time|time:"H:i" }}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="text-primary mb-0">₹{{ similar.price }}</h6>
                                        <a href="{% url 'travel_option_detail' similar.pk %}" class="btn btn-sm btn-outline-primary">View</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Booking Sidebar -->
        <div class="col-lg-4">
            <div class="card sticky-top fade-in" style="top: 120px;">
                <div class="card-body p-4">
                    <h5 class="mb-3"><i class="bi bi-ticket-detailed-fill"></i> Book This Journey</h5>
                    
                    {% if option.is_available %}
                    <div class="mb-3 p-3 bg-success bg-opacity-10 border border-success rounded">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <span class="text-success fw-bold">Available</span>
                        </div>
                        <p class="text-success mb-0 mt-1">{{ option.available_seats }} seats remaining</p>
                    </div>
                    {% else %}
                    <div class="mb-3 p-3 bg-danger bg-opacity-10 border border-danger rounded">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-x-circle-fill text-danger me-2"></i>
                            <span class="text-danger fw-bold">Sold Out</span>
                        </div>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Base Price:</span>
                            <span class="fw-bold">₹{{ option.price }}</span>
                        </div>
                        <small class="text-muted">Taxes and fees included</small>
                    </div>

                    {% if option.is_available %}
                    <div class="d-grid gap-2">
                        {% if user.is_authenticated %}
                        <a href="{% url 'book_travel' option.pk %}" class="btn btn-primary btn-lg">
                            <i class="bi bi-ticket-detailed-fill"></i> Book Now
                        </a>
                        {% else %}
                        <a href="{% url 'login' %}?next={% url 'book_travel' option.pk %}" class="btn btn-primary btn-lg">
                            <i class="bi bi-box-arrow-in-right"></i> Login to Book
                        </a>
                        {% endif %}
                        <button class="btn btn-outline-primary" onclick="shareTravel()">
                            <i class="bi bi-share-fill"></i> Share
                        </button>
                    </div>
                    {% else %}
                    <div class="d-grid">
                        <button class="btn btn-secondary btn-lg" disabled>
                            <i class="bi bi-x-circle-fill"></i> Not Available
                        </button>
                    </div>
                    {% endif %}

                    <hr>

                    <!-- Quick Stats -->
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="text-center p-2 border rounded">
                                <i class="bi bi-shield-check text-success"></i>
                                <small class="d-block text-muted">Secure</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-2 border rounded">
                                <i class="bi bi-arrow-repeat text-info"></i>
                                <small class="d-block text-muted">Refundable</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <div class="mt-4">
        <a href="{% url 'travel_options' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Search Results
        </a>
    </div>
</div>

<script>
function shareTravel() {
    if (navigator.share) {
        navigator.share({
            title: 'Travel Option - {{ option.source }} to {{ option.destination }}',
            text: 'Check out this travel option from {{ option.source }} to {{ option.destination }} for ₹{{ option.price }}',
            url: window.location.href
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Link copied to clipboard!');
        });
    }
}
</script>
{% endblock %}